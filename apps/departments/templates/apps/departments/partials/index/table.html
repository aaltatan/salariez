{% load i18n math_filters %}

<c-layout.table-container>
  <form hx-get="{{ bulk_path }}" x-data="{ selectedRows: [] }">
    <c-table.container>
      <input
        data-include
        type="hidden"
        name="order"
        value="{% firstof request.GET.order default_column %}"
      />

      <c-table.table>
        <c-table.header-row>
          <c-table.header-cell>
            {% if can_delete %}
            <c-table.check data_check="all" />
            {% endif %}
          </c-table.header-cell>

          <c-table.header-cell
          hx-get="{{ index_path }}"
          hx-target="{{ target }}"
          code_name="pk"
          name="{% translate 'id' %}"
          />

          <c-table.header-cell
            hx-get="{{ index_path }}"
            hx-target="{{ target }}"
            code_name="department_id"
            name="{% translate 'code' %}"
          />

          <c-table.header-cell
            hx-get="{{ index_path }}"
            hx-target="{{ target }}"
            code_name="name"
            name="{% translate 'name' %}"
          />

          <c-table.header-cell name="{% translate 'type' %}" />

          <c-table.header-cell
            hx-get="{{ index_path }}"
            hx-target="{{ target }}"
            code_name="level"
            name="{% translate 'level' %}"
          />

          <c-table.header-cell
            hx-get="{{ index_path }}"
            hx-target="{{ target }}"
            code_name="cost_center"
            name="{% translate 'cost center' %}"
          />

          <c-table.header-cell
            hx-get="{{ index_path }}"
            hx-target="{{ target }}"
            code_name="parent"
            name="{% translate 'parent' %}"
          />

          <c-table.header-cell />
        </c-table.header-row>

        {% if user.is_superuser %}
        <c-table.unselect-all colspan="8">
          {% if user.is_superuser %}
          <c-table.action-input
            name="bulk_reslugify"
            value="{% translate 'reslugify'|title %}"
            title="{% translate 'reslugify'|title %}"
          />
          {% endif %}
        </c-table.unselect-all>
        {% endif %}

        <!-- end header -->

        <!-- start rows -->
        <c-table.tbody>
          {% for obj in qs %}
          <c-table.tr>
            <c-table.check />

            <c-table.td>{{ obj.id }}</c-table.td>
            {% if can_update %}
            <c-table.td href="{{ obj.get_update_path }}">
              {{ obj.department_id }}
            </c-table.td>
            {% else %}
            <c-table.td>{{ obj.department_id }}</c-table.td>
            {% endif %} {% if can_update %}
            <c-table.td
              href="{{ obj.get_update_path }}"
              x-data="{ 
              name: '{{ obj.name }}',
              level: {{ obj.level }},
              isPrimary: '{{ obj.is_leaf_node }}' === 'True',
            }"
            >
              <span
                :class="'px-' + level * 3"
                x-html="isPrimary ? name : `${name} <span class='text-[red]'>*</span>`"
                class="whitespace-nowrap"
              ></span>
            </c-table.td>
            {% else %}
            <c-table.td>
              <span
                :class="'px-' + level * 3"
                x-html="isPrimary ? name : `${name} <span class='text-[red]'>*</span>`"
                class="whitespace-nowrap"
              ></span>
            </c-table.td>
            {% endif %}

            <c-table.td>
              {% if obj.is_leaf_node %}
              <span class="capitalize"> {% translate 'partial' %} </span>
              {% else %}
              <span class="capitalize"> {% translate 'primary' %} </span>
              {% endif %}
            </c-table.td>

            <c-table.td>{{ obj.level }}</c-table.td>

            {% if perms.cost_centers.update_costcenter %}
            <c-table.td href="{{ obj.cost_center.get_update_path }}">
              <span class="whitespace-nowrap">
                {{ obj.cost_center.name }}
              </span>
            </c-table.td>
            {% else %}
            <c-table.td>
              <span class="whitespace-nowrap">
                {{ obj.cost_center.name }}
              </span>
            </c-table.td>
            {% endif %}

            <c-table.td>
              {% if obj.parent %}
              <span class="whitespace-nowrap">{{ obj.parent }}</span>
              {% endif %}
            </c-table.td>

            <c-table.td><c-context.context /></c-table.td>
          </c-table.tr>
          {% empty %}
          <c-table.empty-tr colspan="4" />
          {% endfor %}
        </c-table.tbody>
        <!-- end rows -->
      </c-table.table>
    </c-table.container>
  </form>
  {% include 'partials/pagination/base.html' %}
</c-layout.table-container>
